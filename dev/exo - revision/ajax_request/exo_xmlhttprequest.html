<!Doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMLHttpRequest</title>
</head>
<body>
    <h1>Inscription</h1>
    <form id="form">
        <div class="input-box">
            <label for="fname">Prenom</label>
            <input type="text" id="fname" name="fname">
        </div>
        <div class="input-box">
            <label for="lname">Nom</label>
            <input type="text" id="lname" name="lname">
        </div>
        <div class="input-box">
            <label for="email">Email</label>
            <input type="text" id="email" name="email">
        </div>
        <input class="btn-send" type="submit">
    </form>

    <div id="server-response">
        En attente d'envoi du formulaire...
    </div>
</body>
<style type="text/css">
    body {
        margin: 0;
    }
    h1 {
        text-align: center;
    }
    form {
        width: fit-content;
        max-width: 500px;
        margin: auto;
    }
    .input-box {
        display: flex;
        margin-top: 15px;;
    }
    label, input {
        padding: 5px;
        margin: 0;
    }
    label {
        width: 70px;
        border-radius: 5px 0 0 5px;
        background-color: #2c2c2c;
        color: #fff;
    }
    input {
        background-color: #fff;
    }
    .btn-send {
        margin-top: 15px;
        width: 100%;
    }
    #server-response {
        box-sizing: border-box;
        margin: 15px auto 0;
        padding: 15px;
        max-width: 259px;
        border: 2px dashed #2c2c2c;
    }
</style>
<script type="text/javascript">

    class Form {
        constructor(idForm, idInputFName, idInputLName, idInputEmail, idTarget) {
            this.form = document.getElementById(idForm);
            this.InputFName = document.getElementById(idInputFName);
            this.InputLName = document.getElementById(idInputLName);
            this.InputEmail = document.getElementById(idInputEmail);
            this.target = document.getElementById(idTarget);
            this.initForm();
        }
        initForm() {
            this.form.addEventListener('submit', (event) => {
                event.preventDefault();
                
                let dial = '';

                let validData = true;
                if (!this.isValidName(this.InputFName.value)) {
                    dial += 'Le pr√©nom est invalide<br>';
                    validData = false;
                }
                if (!this.isValidName(this.InputLName.value)) {
                    dial += 'Le nom est invalide<br>';
                    validData = false;
                }
                if (!this.isValidEmail(this.InputEmail.value)) {
                    dial += 'L\'email est invalide<br>';
                    validData = false;
                }
                if (validData) {                 
                    dial = 'Envoi du formulaire au serveur en cours<br>';
                    this.dialServeur();   
                }
                this.target.innerHTML = dial;
            });
        }
        isValidName($name) {
            let regex = /.+/;
            return regex.test($name);
        }
        isValidEmail($email) {
            let regex = /.+/;
            return regex.test($email);
        }
        dialServeur() {
            // console.log('AZERTYOP');
            let xhr = new XMLHttpRequest();
            xhr.open('POST', 'exo_xmlhttprequest.php');
            xhr.responseType = 'json';

            xhr.send();

            xhr.onload = (event) => {
                this.target.innerHTML = event.target.response;
            };
        }
    }
    new Form('form', 'fname', 'lname', 'email', 'server-response');

</script>
</html>